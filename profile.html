<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RPSU Lost & Found — Profile Setup</title>
  <style>
    /* RESET + BASE */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height:100%; }
    body {
      font-family: "Poppins", Arial, sans-serif;
      background: linear-gradient(160deg,#0b1530 0%, #172a4a 45%, #223858 100%);
      color: #e9eefc;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
      display:flex;
    }

    /* SIDEBAR (desktop) */
    .sidebar{
      position:fixed; left:0; top:0; height:100vh; width:230px;
      background:linear-gradient(180deg,#0f1a33 0%, #162a52 100%);
      padding:34px 18px; color:#ffffff; box-shadow:2px 0 18px rgba(0,0,0,0.4);
      z-index:1200; display:flex; flex-direction:column; gap:14px;
    }
    .brand{font-weight:700; letter-spacing:0.6px; text-align:center; margin-bottom:16px; font-size:1.05rem;}
    .navlink{display:block; text-decoration:none; color:#cbd6f7; padding:12px; border-radius:10px; transition:all .22s ease; font-weight:500;}
    .navlink:hover{ background: rgba(255,255,255,0.04); color:#fff; transform: translateX(4px); }

    /* TOPBAR (mobile) */
    .topbar{
      position: fixed; left:0; right:0; top:0; height:62px; display:none;
      align-items:center; justify-content:space-between; padding:10px 16px; gap:12px;
      z-index:1150;
      background: linear-gradient(180deg, rgba(8,13,26,0.5), rgba(12,20,36,0.25));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .topbar .title { color:#fff; font-weight:600; font-size:1.05rem; }

    /* HAMBURGER */
    .hamburger {
      width:36px; height:30px; display:inline-flex; flex-direction:column; justify-content:space-between;
      cursor:pointer; -webkit-tap-highlight-color:transparent;
    }
    .hamburger span {
      display:block; height:3px; border-radius:3px; background:#dfe8ff;
      transform-origin: 3px 50%;
      transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .2s ease, margin .2s ease;
    }
    /* left-to-right cross animation (matching earlier change) */
    .hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(-4px, 4px); }
    .hamburger.open span:nth-child(2) { opacity: 0; transform: translateX(6px); }
    .hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(-5px, -5px); }

    /* MOBILE NAV (slide-in) */
    .mobile-nav {
      position: fixed; top:62px; right:-100%; width:78%; max-width:420px; height:calc(100vh - 62px);
      background: linear-gradient(180deg,#091227 0%, #12263f 100%);
      box-shadow: -12px 0 40px rgba(0,0,0,0.6);
      padding:20px; z-index:1250; transition: right .34s cubic-bezier(.2,.9,.2,1);
      display:flex; flex-direction:column; gap:12px;
    }
    .mobile-nav.open { right:0; }
    .mobile-nav a { color:#dbe9ff; text-decoration:none; padding:12px; border-radius:10px; display:block; }
    .mobile-nav a:hover { background: rgba(255,255,255,0.03); transform: translateX(6px); }

    /* MAIN */
    main { margin-left:250px; padding:80px 36px; width:calc(100% - 250px); }
    h1 { font-size:1.6rem; margin-bottom:12px; color:#fff; }
    .muted { color:#b9c7ff; }

    /* PROFILE LAYOUT - TRANSPARENT CARD (no white box) */
    .profile-wrap {
      display:flex; gap:28px; align-items:flex-start; flex-wrap:wrap;
      max-width:920px;
    }

    /* profile card is transparent dark surface (no solid white) */
    .profile-card {
      flex: 1 1 420px;
      background: linear-gradient(180deg, rgba(9,16,30,0.32), rgba(12,20,36,0.28));
      border-radius: 14px;
      padding: 20px;
      color: #eaf0ff;
      box-shadow: 0 8px 30px rgba(6,10,20,0.32);
      backdrop-filter: blur(6px);
    }

    /* Profile photo area */
    .photo-area {
      display:flex; flex-direction:column; align-items:center; gap:12px; margin-bottom:10px;
    }
    .photo-preview {
      width:120px; height:120px; border-radius:50%; overflow:hidden;
      display:inline-flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 2px solid rgba(255,255,255,0.05);
      position:relative; box-shadow: 0 8px 30px rgba(0,0,0,0.35);
    }
    .photo-preview img { width:100%; height:100%; object-fit:cover; display:block; }

    .photo-actions { display:flex; gap:8px; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:8px 12px; border-radius:10px; border:none; font-weight:600; cursor:pointer;
      transition:all .18s ease;
      background: linear-gradient(135deg,#3f6bff 0%, #1f50ff 100%); color:#fff;
    }
    .btn.ghost { background: rgba(255,255,255,0.06); color:#eaf0ff; border: 1px solid rgba(255,255,255,0.06); }
    .small { padding:6px 10px; font-size:0.95rem; border-radius:8px; }

    /* FORM - each row is transparent with faint divider and glow on focus */
    form.profile-form { width:100%; display:flex; flex-direction:column; gap:12px; margin-top:6px; }
    .row {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
      display:flex; flex-direction:column; gap:6px;
      transition: box-shadow .16s ease, border-color .16s ease, transform .12s ease;
    }
    /* glow effect when focused (keyboard or tap) */
    .row:focus-within {
      box-shadow: 0 8px 30px rgba(31,80,255,0.12);
      border-color: rgba(63,107,255,0.9);
      transform: translateY(-2px);
    }
    label { color:#dbe9ff; font-size:0.92rem; font-weight:600; }
    input[type="text"], input[type="file"] {
      background: transparent; border: none; color: #eaf0ff; font-size:1rem;
      outline:none; padding:6px 0;
    }
    input::placeholder { color: rgba(234,240,255,0.5); }

    .hint { color: rgba(234,240,255,0.6); font-size:0.9rem; }

    .error { color:#ff7b7b; font-size:0.9rem; }

    /* right column note box */
    .note-card {
      width:260px; min-width:220px;
      background: linear-gradient(180deg, rgba(16,30,57,0.28), rgba(20,36,62,0.20));
      padding:18px; border-radius:12px; color:#dbe9ff; font-size:0.95rem;
      box-shadow: 0 8px 30px rgba(6,12,28,0.32);
    }

    /* footer row */
    .form-footer { display:flex; gap:10px; margin-top:8px; align-items:center; }

    /* small touches */
    .remove { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#ffd6d6; }
    .success-msg { color:#7ef0a6; font-weight:600; font-size:0.95rem; }

    /* RESPONSIVE */
    @media (max-width: 900px) {
      main { padding:78px 18px; margin-left:0; width:100%; }
      .profile-wrap { gap:18px; }
    }
    @media (max-width: 780px) {
      .sidebar { display:none; }
      .topbar { display:flex; }
      .note-card { width:100%; max-width:420px; }
    }
    @media (max-width:480px) {
      .photo-preview { width:100px; height:100px; }
      .note-card { display:none; }
    }
  </style>
</head>
<body>

  <!-- Sidebar (desktop) -->
  <aside class="sidebar" aria-label="Primary Navigation">
    <div class="brand">RPSU Lost &amp; Found</div>
    <a class="navlink" href="profile.html">Profile</a>
    <a class="navlink" href="Main.html">Post Issues</a>
    <a class="navlink" href="Allpost.html">All Posts</a>
    <a class="navlink" href="Myissue.html">My Issues</a>
    <a class="navlink" href="index.html">Logout</a>
  </aside>

  <!-- Topbar (mobile) -->
  <div class="topbar" role="banner">
    <div class="title">Profile Setup</div>
    <div class="hamburger" id="hamburgerBtn" aria-label="Open menu" aria-expanded="false" role="button" tabindex="0">
      <span></span><span></span><span></span>
    </div>
  </div>

  <!-- mobile nav -->
  <nav class="mobile-nav" id="mobileNav" aria-hidden="true">
    <a href="Main.html">Profile</a>
    <a href="Main.html">Post Issues</a>
    <a href="Allpost.html">All Posts</a>
    <a href="Myissue.html">My Issues</a>
    <a href="#">Logout</a>
  </nav>

  <main>
    <h1>Set Up Your Profile</h1>
    <div class="muted" style="margin-bottom:16px;">Complete required fields to proceed. Profile photo optional.</div>

    <div class="profile-wrap">
      <!-- Left: profile controls -->
      <section class="profile-card" aria-labelledby="profile-heading">
        <div id="profile-heading" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Profile Setup Section</div>

        <div class="photo-area" role="group" aria-label="Profile photo">
          <div class="photo-preview" id="photoPreview" aria-hidden="false">
            <!-- placeholder SVG avatar -->
            <img id="previewImg" src="" alt="Profile preview" style="display:none;">
            <svg id="avatarPlaceholder" width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity:0.75;">
              <path d="M12 12a4 4 0 100-8 4 4 0 000 8z" stroke="rgba(234,240,255,0.85)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 20c0-3.3 3.6-6 8-6s8 2.7 8 6" stroke="rgba(234,240,255,0.6)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>

          <div class="photo-actions">
            <label for="photoInput" class="btn small" style="cursor:pointer;">Upload Photo</label>
            <input id="photoInput" type="file" accept="image/*" style="display:none">
            <button type="button" id="removePhoto" class="btn small remove" title="Remove photo">Remove</button>
          </div>
          <div class="hint">Round profile image (optional). Max 2MB recommended.</div>
        </div>

        <!-- form -->
        <form id="profileForm" action="profile.php" method="POST" enctype="multipart/form-data">
    <input type="hidden" id="userId" name="user_id">
    
          <div class="row">
  <label for="fullName">Full Name *</label>
  <input id="fullName" name="full_name" type="text" placeholder="Enter your full name" required aria-required="true" />
  <div class="error" id="errFullName" style="display:none"></div>
</div>

<div class="row">
  <label for="nickname">Nickname *</label>
  <input id="nickname" name="nickname" type="text" placeholder="Enter your nickname" required aria-required="true" />
  <div class="error" id="errNickname" style="display:none"></div>
</div>

<div class="row">
  <label for="studentId">Student ID *</label>
  <input id="studentId" name="student_id" type="text" placeholder="e.g., 2023-001" required aria-required="true" />
  <div class="error" id="errStudentId" style="display:none"></div>
</div>

<div class="row">
  <label for="department">Department *</label>
  <input id="department" name="department" type="text" placeholder="e.g., CSE, BBA" required aria-required="true" />
  <div class="error" id="errDepartment" style="display:none"></div>
</div>

<div class="row">
  <label for="batch">Batch *</label>
  <input id="batch" name="batch" type="text" placeholder="e.g., 21st" required aria-required="true" />
  <div class="error" id="errBatch" style="display:none"></div>
</div>

<div class="form-footer">
  <button type="submit" class="btn small" id="saveBtn">Save Profile</button>
  <button type="button" class="btn small ghost" id="skipBtn">Skip for now</button>
  <div id="saveMsg" style="margin-left:8px;"></div>
</div>
<input type="hidden" name="user_id" id="userId" value="">


        </form><Form:post></Form:post>
      </section>

      <!-- Right: info/note -->
      <aside class="note-card" aria-hidden="false">
        <strong>Profile tips</strong>
        <ul style="margin-top:8px;line-height:1.6;">
          <li>Full name, nickname, student ID, department &amp; batch are required.</li>
          <li>Profile photo is optional — recommended for easier contact.</li>
          <li>Data stored locally (localStorage). For a real app you'd send this to your server.</li>
        </ul>
      </aside>
    </div>
  </main>

  <script>
    /* --- Mobile nav behavior --- */
    const hamburger = document.getElementById('hamburgerBtn');
    const mobileNav = document.getElementById('mobileNav');
    let navOpen = false;

    function setNavState(open) {
      navOpen = !!open;
      hamburger.classList.toggle('open', navOpen);
      hamburger.setAttribute('aria-expanded', String(navOpen));
      mobileNav.classList.toggle('open', navOpen);
      mobileNav.setAttribute('aria-hidden', String(!navOpen));
      document.body.style.overflow = navOpen ? 'hidden' : '';
    }

    hamburger.addEventListener('click', () => setNavState(!navOpen));
    hamburger.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setNavState(!navOpen); }
    });

    // close mobile nav when clicking outside
    window.addEventListener('click', (e) => {
      if (!navOpen) return;
      const target = e.target;
      if (!mobileNav.contains(target) && !hamburger.contains(target)) setNavState(false);
    });

    // close with Escape
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') setNavState(false); });

    /* --- Profile photo upload (optional) --- */
    const photoInput = document.getElementById('photoInput');
    const previewImg = document.getElementById('previewImg');
    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
    const removePhotoBtn = document.getElementById('removePhoto');
    const photoPreviewEl = document.getElementById('photoPreview');

    function showPreview(dataUrl) {
      if (!dataUrl) {
        previewImg.style.display = 'none';
        avatarPlaceholder.style.display = 'block';
        previewImg.src = '';
        return;
      }
      previewImg.src = dataUrl;
      previewImg.style.display = 'block';
      avatarPlaceholder.style.display = 'none';
    }

    photoInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file.');
        photoInput.value = '';
        return;
      }
      if (file.size > 2 * 1024 * 1024) { // 2MB soft limit
        if (!confirm('Image is larger than 2MB. Continue?')) { photoInput.value = ''; return; }
      }
      const reader = new FileReader();
      reader.onload = () => {
        showPreview(reader.result);
        // store preview temporarily (not yet saved)
        photoPreviewEl.dataset.preview = reader.result;
      };
      reader.readAsDataURL(file);
    });

    removePhotoBtn.addEventListener('click', () => {
      photoInput.value = '';
      delete photoPreviewEl.dataset.preview;
      showPreview('');
    });

    /* --- Form handling + localStorage --- */
    const form = document.getElementById('profileForm');
    const saveMsg = document.getElementById('saveMsg');
    const skipBtn = document.getElementById('skipBtn');

    function showError(id, text) {
      const el = document.getElementById(id);
      if (!el) return;
      if (!text) { el.style.display = 'none'; el.textContent = ''; }
      else { el.style.display = 'block'; el.textContent = text; }
    }

    function validate(values) {
      let ok = true;
      // simple checks: non-empty
      if (!values.fullName) { showError('errFullName', 'Full name is required'); ok = false; } else showError('errFullName','');
      if (!values.nickname) { showError('errNickname', 'Nickname is required'); ok = false; } else showError('errNickname','');
      if (!values.studentId) { showError('errStudentId', 'Student ID is required'); ok = false; } else showError('errStudentId','');
      if (!values.department) { showError('errDepartment', 'Department is required'); ok = false; } else showError('errDepartment','');
      if (!values.batch) { showError('errBatch', 'Batch is required'); ok = false; } else showError('errBatch','');
      return ok;
    }

    // Skip button - optional: it doesn't validate/save; returns user to Allpost or main
    skipBtn.addEventListener('click', () => {
      if (confirm('Skip profile setup for now? You can edit it later.')) {
        // navigate to Allpost.html (or Main.html) — adjust as you prefer
        window.location.href = 'Allpost.html';
      }
    });
    document.addEventListener("DOMContentLoaded", () => {
  fetch("session_user.php")
    .then(res => res.json())
    .then(user => {
      if (!user.logged) {
        window.location.href = "login.html";
        return;
      }

      document.getElementById("userId").value = user.user_id;

      // Load profile from database
      fetch("get_profile.php?user_id=" + user.user_id)
        .then(res => res.json())
        .then(data => {
          if (!data || data.status === "no_profile") return;

          document.getElementById("fullName").value = data.full_name || "";
          document.getElementById("nickname").value = data.nickname || "";
          document.getElementById("studentId").value = data.student_id || "";
          document.getElementById("department").value = data.department || "";
          document.getElementById("batch").value = data.batch || "";

          if (data.photo) {
            document.getElementById("previewImg").src = "uploads/" + data.photo;
            document.getElementById("previewImg").style.display = "block";
          }
        });
    });
});
document.getElementById("profileForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const formData = new FormData(document.getElementById("profileForm"));

  fetch("profile.php", {
    method: "POST",
    body: formData
  })
    .then(res => res.text())
    .then(data => {
      alert("Profile Saved Successfully!");
      window.location.href = "Allpost.html";
    })
    .catch(() => alert("Error saving profile!"));
});

  </script>
</body>
</html>
