<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RPSU Lost & Found â€” All Posts</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Poppins",Arial,sans-serif;
      background:linear-gradient(160deg,#050d20 0%,#101d3b 45%,#1c2d50 100%);
      color:#e6ecff;min-height:100vh;display:flex;
    }

    /* Sidebar */
    .sidebar{
      position:fixed;left:0;top:0;height:100vh;width:230px;
      background:rgba(10,20,40,0.7);backdrop-filter:blur(10px);
      padding:34px 18px;display:flex;flex-direction:column;gap:14px;
      box-shadow:2px 0 20px rgba(0,0,0,0.4);z-index:1200;
    }
    .brand{font-weight:700;text-align:center;margin-bottom:16px;font-size:1.05rem;color:#fff;}
    .navlink{color:#cbd6f7;text-decoration:none;padding:12px 12px;border-radius:10px;transition:all .22s ease;font-weight:500;}
    .navlink:hover{background:rgba(255,255,255,0.07);color:#fff;transform:translateX(4px);}

    /* Topbar */
    .topbar{
      position:fixed;top:0;left:0;right:0;height:60px;display:none;
      align-items:center;justify-content:space-between;padding:10px 18px;
      background:rgba(8,15,30,0.5);backdrop-filter:blur(6px);
      border-bottom:1px solid rgba(255,255,255,0.05);
        z-index: 3000;

    }
    .topbar .title{color:#fff;font-weight:600;font-size:1.05rem;}

    /* Hamburger */
    .hamburger{width:36px;height:30px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer}
    .hamburger span{height:3px;border-radius:3px;background:#dfe8ff;transition:.3s}
    .hamburger.open span:nth-child(1){transform:rotate(45deg) translate(5px,6px)}
    .hamburger.open span:nth-child(2){opacity:0}
    .hamburger.open span:nth-child(3){transform:rotate(-45deg) translate(6px,-6px)}

    /* Main */
    main{margin-left:250px;padding:80px 36px 60px 36px;width:calc(100% - 250px)}
    header.main-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
    header.main-head h1{color:#fff;font-size:1.5rem}

    /* Post Cards */
    .issue-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;max-width:1200px}
    .issue-card{
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.06);
      border-radius:14px;padding:16px;
      box-shadow:0 6px 22px rgba(0,0,0,0.35);
      transition:all .22s ease;cursor:pointer;position:relative;overflow:hidden;
      display:flex;flex-direction:column;
    }
    .issue-card:hover{transform:translateY(-6px);box-shadow:0 10px 34px rgba(60,110,255,0.15);border-color:rgba(90,140,255,0.2)}
    .issue-card h3{font-size:1.12rem;margin-bottom:8px;color:#fff}
    .issue-card p{font-size:.95rem;color:#d6e3ff;line-height:1.45;margin-bottom:8px}

    .small-meta{color:#bcd0ff;font-size:.9rem;margin-top:auto;display:flex;align-items:center;justify-content:space-between;gap:8px}

    /* action buttons inside card */
    .card-actions{display:flex;gap:8px;margin-top:10px}
    .btn{
      background:linear-gradient(135deg,#3f6bff 0%,#1f50ff 100%);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
      transition:transform .14s ease,box-shadow .14s ease;
    }
    .btn.ghost{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06)}
    .btn:active{transform:translateY(1px)}
    .btn.profile{background:linear-gradient(135deg,#ff6ba6 0%,#ff3b8a 100%)}

    /* POST DETAIL PANEL (overlay) */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .26s ease;z-index:1400}
    .overlay.active{opacity:1;pointer-events:auto}
    .panel{
      position:fixed;right:50%;top:50%;transform:translate(50%,-50%) scale(.98);
      width:90%;max-width:780px;background:linear-gradient(180deg,rgba(16,30,57,0.96),rgba(22,38,70,0.96));
      border-radius:14px;padding:18px;color:#eaf0ff;box-shadow:0 30px 80px rgba(0,0,0,0.6);
      opacity:0;pointer-events:none;transition:opacity .28s ease,transform .28s cubic-bezier(.2,.9,.2,1);z-index:1500;max-height:84vh;overflow:auto;
    }
    .panel.active{opacity:1;transform:translate(50%,-50%) scale(1);pointer-events:auto}
    .panel img.post-img{width:100%;height:280px;object-fit:cover;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
    .panel h2{font-size:1.25rem;margin-bottom:8px;color:#fff}
    .panel p{color:#dbe9ff;line-height:1.5}

    /* poster summary (round avatar + name) */
    .poster-row{display:flex;gap:12px;align-items:center;margin-top:14px;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.04)}
    .avatar{width:56px;height:56px;border-radius:50%;overflow:hidden;background:linear-gradient(135deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;border:2px solid rgba(255,255,255,0.04)}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .poster-info{flex:1}
    .poster-name{font-weight:700;color:#fff}
    .poster-sub{color:#cfe0ff;font-size:0.95rem}
    .poster-actions{display:flex;gap:8px;align-items:center}

    /* profile modal */
    .profile-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);width:94%;max-width:420px;background:linear-gradient(180deg,rgba(9,17,34,0.98),rgba(13,24,44,0.98));padding:18px;border-radius:12px;box-shadow:0 30px 70px rgba(0,0,0,0.6);opacity:0;pointer-events:none;transition:opacity .2s ease,transform .2s cubic-bezier(.2,.9,.2,1);z-index:1600}
    .profile-modal.active{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1)}
    .profile-modal .top{display:flex;gap:12px;align-items:center}
    .profile-modal .top .avatar-lg{width:84px;height:84px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,0.04)}
    .profile-modal .top .avatar-lg img{width:100%;height:100%;object-fit:cover}
    .profile-modal .info{margin-top:12px}
    .profile-modal .info p{margin:6px 0;color:#d6e3ff}
    .close-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
/* Mobile Nav (fix for sidebar menu) */
.mobile-nav {
  position: fixed;
  top: 0;
  right: -260px;
  width: 220px;
  height: 100vh;
  background: linear-gradient(180deg, rgba(9,17,34,0.95), rgba(14,28,55,0.95));
  display: flex;
  flex-direction: column;
  padding: 80px 24px;
  gap: 20px;
  transition: right 0.3s ease;
  z-index: 1300;
}
.mobile-nav.open {
  right: 0;
}
.mobile-nav a {
  color: #d6e3ff;
  text-decoration: none;
  font-weight: 500;
  font-size: 1rem;
  padding: 10px 0;
  transition: color 0.2s ease;
}
.mobile-nav a:hover {
  color: #fff;
}

    /* responsive */
    @media(max-width:900px){main{padding:78px 18px;margin-left:0;width:100%}}
    @media(max-width:780px){.sidebar{display:none}.topbar{display:flex}.panel img.post-img{height:200px}}
  </style>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">RPSU Lost &amp; Found</div>
    <a class="navlink" href="profile.html">Profile</a>
    <a class="navlink" href="Main.html">Post Issues</a>
    <a class="navlink" href="allpost.html">All Posts</a>
    <a class="navlink" href="myissue.html">My Issues</a>
    <a class="navlink" href="index.html">Logout</a>
  </aside>

  <!-- Topbar -->
  <div class="topbar">
    <div class="title">RPSU â€” All Posts</div>
    <div class="hamburger" id="hamburgerBtn" aria-expanded="false" role="button" tabindex="0">
      <span></span><span></span><span></span>
    </div>
  </div>

  <!-- Mobile Nav -->
  <nav class="mobile-nav" id="mobileNav" aria-hidden="true">
    <a href="profile.html">Profile</a>
    <a href="Main.html">Post Issues</a>
    <a href="allpost.html">All Posts</a>
    <a href="myissue.html">My Issues</a>
    <a href="index.html">Logout</a>
  </nav>

  <!-- Main -->
  <main>
    <header class="main-head">
      <h1>All User Posts</h1>
      <div class="muted">Tap a post to view details â€” poster summary & chat available under the post.</div>
    </header>

    <section class="issue-list" id="allPosts" aria-live="polite"></section>
  </main>

  <!-- Overlay + Post Detail Panel -->
  <div class="overlay" id="overlay" onclick="closePanel()"></div>

  <aside class="panel" id="postPanel" role="dialog" aria-hidden="true" aria-label="Post details">
    <button class="close-btn" id="closePanelBtn" style="float:right;">Close</button>
    <img class="post-img" id="panelImg" src="" alt="Post image" style="display:none">
    <h2 id="panelTitle">Title</h2>
    <p id="panelDesc"></p>

    <!-- poster summary -->
    <div class="poster-row" id="posterRow" style="display:none">
      <div class="avatar" id="posterAvatar"><!-- img injected --></div>
      <div class="poster-info">
        <div class="poster-name" id="posterName">Name</div>
        <div class="poster-sub" id="posterSub">Department â€¢ Batch</div>
      </div>
      <div class="poster-actions">
        <button class="btn" id="panelChatBtn">ðŸ’¬ Chat</button>
        <button class="btn profile" id="panelViewBtn">View</button>
      </div>
    </div>
  </aside>

  <!-- Profile modal -->
  <aside class="profile-modal" id="profileModal" role="dialog" aria-hidden="true" aria-label="Profile details">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong style="color:#fff">Profile</strong>
      <button class="close-btn" id="closeProfileBtn">Close</button>
    </div>
    <div class="top" style="margin-top:12px">
      <div class="avatar-lg" id="modalAvatar"><!-- img injected --></div>
      <div style="margin-left:8px">
        <div id="modalName" style="font-weight:700;color:#fff;font-size:1.05rem"></div>
        <div id="modalNick" style="color:#cfe0ff;margin-top:6px"></div>
      </div>
    </div>
    <div class="info" id="modalInfo">
      <p><strong>Student ID:</strong> <span id="modalStudent"></span></p>
      <p><strong>Department:</strong> <span id="modalDept"></span></p>
      <p><strong>Batch:</strong> <span id="modalBatch"></span></p>
    </div>
  </aside>

  <script>
  async function loadPosts() {
    try {
      const res = await fetch("fetch_posts.php"); // backend fetch
      const data = await res.json();

      const listEl = document.getElementById("allPosts");
      listEl.innerHTML = "";

      if (!data || data.length === 0) {
        listEl.innerHTML = "<p>No posts found.</p>";
        return;
      }

      data.forEach(p => {
        const c = document.createElement("article");
        c.className = "issue-card";
        c.innerHTML = `
          <div style="flex:1">
            <h3>${escapeHtml(p.title)}</h3>
            <p><strong>Place:</strong> ${escapeHtml(p.place)}</p>
            <p>${escapeHtml(p.description || "")}</p>
          </div>
          <div class="small-meta">
            <div style="display:flex;align-items:center;gap:8px">
              <div style="width:36px;height:36px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,0.03)">
                <img src="${escapeAttr(p.photo_url || 'https://via.placeholder.com/80?text=U')}" alt="${escapeAttr(p.full_name || 'User')}" style="width:100%;height:100%;object-fit:cover;display:block">
              </div>
              <div style="font-weight:600;color:#fff">${escapeHtml(p.full_name || 'Unknown')}</div>
            </div>
            <div style="display:flex;gap:8px;">
              <button class="btn" data-id="${p.post_id}" aria-label="Open post">Open</button>
              <button class="btn ghost" data-user="${p.full_name}" aria-label="Chat with poster">Chat</button>
            </div>
          </div>
        `;

        c.querySelector(".btn[data-id]").addEventListener("click", () => openPostPanel(p));
        c.querySelector(".btn.ghost").addEventListener("click", () => startChat(p.full_name));

        listEl.appendChild(c);
      });
    } catch (err) {
      console.error("Error loading posts:", err);
    }
  }

  function escapeHtml(s = "") {
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }
  function escapeAttr(s = "") {
    return String(s).replace(/"/g, "&quot;");
  }

  window.addEventListener("DOMContentLoaded", loadPosts);
</script>

</body>
</html>
